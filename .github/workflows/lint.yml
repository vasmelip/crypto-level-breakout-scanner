name: Code Quality Checks

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check HTML validity
        run: |
          echo "üóë Checking HTML structure..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
          if [ ! -f "index.html" ]; then
            echo "‚ùå Error: index.html not found"
            exit 1
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º DOCTYPE
          if ! grep -q '<!DOCTYPE html>' index.html; then
            echo "‚ùå Error: Missing DOCTYPE"
            exit 1
          fi
          echo "‚úÖ DOCTYPE found"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º meta charset
          if ! grep -q 'charset=UTF-8' index.html; then
            echo "‚ùå Error: Missing charset"
            exit 1
          fi
          echo "‚úÖ Charset declaration found"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º viewport
          if ! grep -q 'viewport' index.html; then
            echo "‚ùå Error: Missing viewport meta tag"
            exit 1
          fi
          echo "‚úÖ Viewport meta tag found"

      - name: Check for required elements
        run: |
          echo "üóë Checking required elements..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ style —Ç–µ–≥–∞
          if ! grep -q '<style>' index.html; then
            echo "‚ùå Error: Missing <style> tag"
            exit 1
          fi
          echo "‚úÖ <style> tag found"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ script —Ç–µ–≥–∞
          if ! grep -q '<script>' index.html; then
            echo "‚ùå Error: Missing <script> tag"
            exit 1
          fi
          echo "‚úÖ <script> tag found"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º main container
          if ! grep -q 'container' index.html; then
            echo "‚ùå Error: Missing container element"
            exit 1
          fi
          echo "‚úÖ Container element found"

      - name: Check CSS variables
        run: |
          echo "üóë Checking CSS variables..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
          color_vars=$(grep -o '--color-[a-z]*:' index.html | wc -l)
          echo "Found $color_vars color variables"
          
          if [ $color_vars -lt 5 ]; then
            echo "‚ùå Error: Not enough color variables defined"
            exit 1
          fi
          echo "‚úÖ CSS variables properly defined"

      - name: Check JavaScript functions
        run: |
          echo "üóë Checking JavaScript functions..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
          functions=("analyzePattern" "drawChart" "scanPair" "displayResults" "clearResults")
          
          for func in "${functions[@]}"; do
            if grep -q "function $func" index.html; then
              echo "‚úÖ Function '$func' found"
            else
              echo "‚ùå Error: Function '$func' not found"
              exit 1
            fi
          done

      - name: Check file integrity
        run: |
          echo "üóë Checking file integrity..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ DEMO_DATA
          if ! grep -q 'const DEMO_DATA' index.html; then
            echo "‚ùå Error: DEMO_DATA not found"
            exit 1
          fi
          echo "‚úÖ DEMO_DATA defined"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º BTC/USDT data
          if ! grep -q "'BTC/USDT'" index.html; then
            echo "‚ùå Error: BTC/USDT test data not found"
            exit 1
          fi
          echo "‚úÖ BTC/USDT test data found"

      - name: Summary
        run: |
          echo ""
          echo "============================================"
          echo "‚úÖ All quality checks passed!"
          echo "============================================"
          echo ""
          echo "File: index.html"
          echo "Size: $(wc -c < index.html) bytes"
          echo "Lines: $(wc -l < index.html) lines"
          echo ""
